name: Validate Branch Name on PR
description: Validates the name of a branch in a pull request based on the target branch.

runs:
  using: "composite"
  steps:
    - name: Validate branch name
      shell: bash
      run: |
        BASE="${{ github.event.pull_request.base.ref }}"
        HEAD="${{ github.event.pull_request.head.ref }}"

        echo "üîç Base branch: $BASE"
        echo "üîç Head branch: $HEAD"

        # Extraire le pr√©fixe (avant le premier /)
        PREFIX="${HEAD%%/*}"

        case "$BASE" in
          develop)
            case "$PREFIX" in
              feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)
                echo "‚úÖ Valid prefix '$PREFIX' for target '$BASE'"
                ;;
              *)
                echo "‚ùå Invalid branch name '$HEAD' for target 'develop'"
                echo "‚û°Ô∏è  Allowed prefixes: feat/, fix/, docs/, style/, refactor/, perf/, test/, build/, ci/, chore/, revert/"
                exit 1
                ;;
            esac
            ;;
          main)
            case "$PREFIX" in
              release|hotfix)
                echo "‚úÖ Valid prefix '$PREFIX' for target '$BASE'"
                ;;
              *)
                echo "‚ùå Invalid branch name '$HEAD' for target 'main'"
                echo "‚û°Ô∏è  Allowed prefixes: release/, hotfix/"
                exit 1
                ;;
            esac
            ;;
          *)
            echo "‚ÑπÔ∏è No branch name restrictions for target '$BASE'."
            ;;
        esac

        echo "‚úÖ Branch name validation passed."
